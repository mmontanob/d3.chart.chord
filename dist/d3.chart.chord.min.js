d3.chart("ChordMatrix",{initialize:function(){function t(){return this.style("fill",function(t){return e.scale(t.source.subindex)}).style("opacity",function(t){return"number"==typeof e.focus&&t.source.index!=e.focus&&t.source.subindex!=e.focus?"0.25":"1"}).style("stroke",function(t){return d3.rgb(e.scale(t.source.subindex)).darker()}).attr("d",s).append("title").text(function(t){var r=t.source.value+" "+e.grps[t.source.index]+" as "+e.grps[t.source.subindex];return t.source.index!=t.target.index&&(r+=", "+t.target.value+" "+e.grps[t.target.index]+" as "+e.grps[t.target.subindex]),r})}var e=this;e.base.classed("ChordMatrix",!0),e.w=e.base.attr("width"),e.h=e.base.attr("height"),e.focus=null,e.mtx=e.mtx?e.mtx:[];var r=e.base.append("g").classed("chart",!0),s=d3.svg.chord(),n=e.layer("chart",r,{dataBind:function(t){function n(t){e.focus=t.index,e.draw(e.scale)}function i(){e.focus=null,e.draw(e.scale)}e.scale=t,r.attr("transform","translate("+e.w/2+","+e.h/2+")"),e.radius();var a=d3.layout.chord().sortGroups(d3.descending).sortSubgroups(d3.descending).sortChords(d3.descending).padding(.04),u=20*(e.grps.length-1),d=d3.svg.arc().innerRadius(e.innerRadius-u).outerRadius(e.outerRadius);s.radius(e.innerRadius-u),a.matrix(e.mtx);var o=this.selectAll(".group").data(a.groups).enter().append("g").attr("class","group");return o.append("path").style("fill","#e6e9f0").attr("id",function(t,e){return"group"+t.index+"-"+e}).attr("d",d).on("mouseover",n).on("mouseout",i).append("title").text(function(t){return e.grps[t.index]}),e.grps.forEach((t,r)=>{var s=20*r,a=d3.svg.arc().innerRadius(e.innerRadius-s).outerRadius(e.outerRadius-s);o.append("path").style("fill",function(t){return e.scale(r)}).style("stroke",function(t){return d3.rgb(e.scale(r)).darker()}).attr("id",function(t){return"group-bar"+t.index+"-"+r}).attr("d",function(t){var s=t.endAngle-t.startAngle,n=e.percs[r][t.index];return a.endAngle(t.startAngle+s*n),a(t)}).on("mouseover",n).on("mouseout",i).append("title").text(function(t){return e.grps[r]})}),this.selectAll(".chord").data(a.chords)},insert:function(){return this.append("path").attr("class","chord")}});n.on("enter",t),n.on("update",t)},radius:function(){this.outerRadius=Math.min(this.w,this.h)/2-4,this.innerRadius=this.outerRadius-20},groups:function(t){return arguments.length?(this.grps=t,this.scale&&this.draw(this.scale),this):this.groups},width:function(t){return arguments.length?(this.w=t,this.x=d3.scale.linear().range([0,this.w]),this.base.attr("width",this.w),this.scale&&this.draw(this.scale),this):this.w},height:function(t){return arguments.length?(this.h=t,this.base.attr("height",this.h),this.scale&&this.draw(this.scale),this):this.h},matrix:function(t){if(!arguments.length)return this.mtx;this.mtx=t;var e=this.mtx.map(t=>t.reduce((t,e)=>t+e));return this.percs=this.mtx.map((t,r)=>t.map(t=>t/e[r])),this.scale&&this.draw(this.scale),this}});